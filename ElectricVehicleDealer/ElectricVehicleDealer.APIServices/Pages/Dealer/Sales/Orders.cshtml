@page "/dealer/sales/orders"
@model ElectricVehicleDealer.Presentation.Pages.Dealer.Sales.OrdersModel
@using System.Linq

@section Head {
    <link rel="stylesheet" href="~/css/manage/crud.css" />
}

<section class="crud-page" id="dealer-orders">
    <header class="crud-header">
        <div>
            <h2>Đơn hàng & tiến độ</h2>
            <p>Theo dõi hành trình xử lý và trạng thái thanh toán của từng đơn hàng đại lý.</p>
        </div>
        <div class="crud-actions">
            <a class="crud-btn" asp-page="/Orders/Create">+ Tạo đơn hàng</a>
        </div>
    </header>

    <div class="crud-table">
        @if (!Model.Orders.Any())
        {
            <div class="crud-empty">Chưa có đơn hàng nào được ghi nhận.</div>
        }
        else
        {
            <table class="crud-table__table crud-table__table--orders">
                <thead>
                    <tr>
                        <th class="crud-table__col-id">Mã</th>
                        <th>Khách hàng</th>
                        <th>Sales phụ trách</th>
                        <th class="text-end">Giá trị</th>
                        <th>Ngày đặt</th>
                        <th>Trạng thái</th>
                        <th class="text-end">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var order in Model.Orders)
                {
                    <tr class="crud-table__row">
                        <td class="crud-table__cell crud-table__cell--id">
                            <span class="crud-id-badge">#@order.OrderId</span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--model">
                            <div class="crud-model">
                                <span class="crud-model__name">@order.CustomerUsername</span>
                                <span class="crud-model__meta">@(!string.IsNullOrWhiteSpace(order.StationName) ? order.StationName : "Chưa gán trạm")</span>
                            </div>
                        </td>
                        <td class="crud-table__cell crud-table__cell--sales">
                            @if (string.IsNullOrWhiteSpace(order.StaffUsername))
                            {
                                <span class="crud-chip crud-chip--muted">Chưa phân công</span>
                            }
                            else
                            {
                                <span class="crud-chip">@order.StaffUsername</span>
                            }
                        </td>
                        <td class="crud-table__cell crud-table__cell--price text-end">
                            <span class="crud-price">@order.TotalPrice.ToString("N0") ₫</span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--date text-end">
                            <span class="crud-meta">@order.OrderDate.ToString("dd/MM/yyyy")</span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--status">
                            <span class="crud-tag @Model.GetStatusClass(order.Status)">
                                @Model.GetStatusLabel(order.Status)
                            </span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--actions text-end">
                            <div class="crud-table__actions">
                                <a class="crud-icon-btn" asp-page="/Orders/Edit" asp-route-id="@order.OrderId">
                                    <span class="crud-icon crud-icon--edit" aria-hidden="true"></span>
                                    <span>Sửa</span>
                                </a>
                                <a class="crud-icon-btn crud-icon-btn--danger" asp-page="/Orders/Delete" asp-route-id="@order.OrderId">
                                    <span class="crud-icon crud-icon--delete" aria-hidden="true"></span>
                                    <span>Xoá</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        }
    </div>
</section>
