@page "/dealer/customers/profiles"
@model ElectricVehicleDealer.Presentation.Pages.Dealer.Customers.ProfilesModel
@using System.Linq

@section Head {
    <link rel="stylesheet" href="~/css/manage/crud.css" />
}

<section class="crud-page" id="customer-profiles">
    <header class="crud-header">
        <div>
            <h2>Hồ sơ khách hàng</h2>
            <p>Theo dõi tài khoản đại lý, thông tin liên hệ và trạng thái hoạt động.</p>
        </div>
        <div class="crud-actions">
            <a class="crud-btn" asp-page="/Account/Create">+ Thêm tài khoản</a>
        </div>
    </header>

    <div class="crud-table">
        @if (!Model.Accounts.Any())
        {
            <div class="crud-empty">Chưa có tài khoản nào được tạo.</div>
        }
        else
        {
            <table class="crud-table__table crud-table__table--accounts">
                <thead>
                    <tr>
                        <th class="crud-table__col-id">Mã</th>
                        <th>Tài khoản</th>
                        <th>Liên hệ</th>
                        <th>Vai trò</th>
                        <th class="text-end">Ngày tạo</th>
                        <th>Trạng thái</th>
                        <th class="text-end">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var account in Model.Accounts)
                {
                    var roles = account.Roles?.Where(role => !string.IsNullOrWhiteSpace(role)).ToList() ?? new List<string>();
                    <tr class="crud-table__row">
                        <td class="crud-table__cell crud-table__cell--id">
                            <span class="crud-id-badge">#@account.AccountId</span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--model">
                            <div class="crud-model">
                                <span class="crud-model__name">@account.Username</span>
                                <span class="crud-model__meta">@account.Email</span>
                            </div>
                        </td>
                        <td class="crud-table__cell crud-table__cell--contact">
                            @if (string.IsNullOrWhiteSpace(account.ContactNumber))
                            {
                                <span class="crud-chip crud-chip--muted">Không có</span>
                            }
                            else
                            {
                                <span class="crud-chip">@account.ContactNumber</span>
                            }
                        </td>
                        <td class="crud-table__cell crud-table__cell--roles">
                            @if (roles.Count == 0)
                            {
                                <span class="crud-chip crud-chip--muted">Chưa gán</span>
                            }
                            else
                            {
                                foreach (var role in roles)
                                {
                                    <span class="crud-chip">@role</span>
                                }
                            }
                        </td>
                        <td class="crud-table__cell crud-table__cell--date text-end">
                            <span class="crud-meta">@account.CreatedAt.ToString("dd/MM/yyyy")</span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--status">
                            <span class="crud-tag @(account.IsActive ? "crud-tag--success" : "crud-tag--danger")">
                                @(account.IsActive ? "Đang hoạt động" : "Ngưng")
                            </span>
                        </td>
                        <td class="crud-table__cell crud-table__cell--actions text-end">
                            <div class="crud-table__actions">
                                <a class="crud-icon-btn" asp-page="/Account/Edit" asp-route-id="@account.AccountId">
                                    <span class="crud-icon crud-icon--edit" aria-hidden="true"></span>
                                    <span>Sửa</span>
                                </a>
                                <a class="crud-icon-btn crud-icon-btn--danger" asp-page="/Account/Delete" asp-route-id="@account.AccountId">
                                    <span class="crud-icon crud-icon--delete" aria-hidden="true"></span>
                                    <span>Xoá</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        }
    </div>
</section>
